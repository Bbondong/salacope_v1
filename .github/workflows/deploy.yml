name: ğŸš€ DÃ©ployer SalaCope

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ TÃ©lÃ©charger le code
      uses: actions/checkout@v3
      
    - name: ğŸ“‹ VÃ©rifier la structure
      run: |
        echo "ğŸ“ Structure du projet :"
        ls -la
        echo ""
        
        if [ -d "public" ]; then
          echo "âœ… Dossier 'public/' trouvÃ©"
          ls -la public/
        else
          echo "âš ï¸ Pas de dossier 'public/', fichiers Ã  la racine :"
          ls *.php 2>/dev/null || echo "Aucun fichier PHP"
        fi
        
    - name: ğŸš€ DÃ©ployer les VRAIS fichiers
      uses: SamKirkland/FTP-Deploy-Action@v4.3.0
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./public/  # ğŸ‘ˆ CHANGE ICI !
        server-dir: ./htdocs/
        exclude: |
          **/.git*
          **/.github/*
        dangerous-clean-slate: true  # ğŸ‘ˆ Nettoie avant !
        
    - name: âœ… Confirmation
      run: |
        echo "ğŸ‰ DÃ‰PLOIEMENT RÃ‰USSI !"
        echo "ğŸŒ Site : https://salacope.infinityfreeapp.com"
        echo "â° Date : $(date)"